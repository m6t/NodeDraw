<!doctype html>
<html>

<head>
    <title>Hi Reddit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; background: darkgray;overflow: hidden}
    </style>
</head>

<body>
    <div>
        Genislik : <select style="height: 30px;width: 100px" id="genislik">
            <option value="1">1</option>
            <option value="3">3</option>
            <option value="5">5</option>
            <option value="7">7</option>
            <option value="9" selected="selected">9</option>
            <option value="11">11</option>
        </select> Renk : <select style="height: 30px;width: 100px"  id="renk">
            <option value="white">white</option>
            <option value="black">black</option>
            <option value="blue" selected="selected">blue</option>
            <option value="red">red</option>
            <option value="green">green</option>
            <option value="yellow">yellow</option>
            <option value="gray">gray</option>
        </select>
    </div>
    <div>
        <canvas style="background: white" width="600" height="600" id="cizim"></canvas>
    </div>
<div>
    <h1>Alper Tokcan <span style="color:red">â™¥</span>Reddit</h1>
</div>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
    var socket = io();
    // $('form').submit(function(){
    //   socket.emit('chat message', $('#m').val());
    //   $('#m').val('');
    //   return false;
    // });
    var lastX, lastY;
    var mousePressed = false;
    var ctx = document.getElementById('cizim').getContext("2d");
    var touchfirst = false;
    socket.on('ciz', function (args) {
        DrawR(args.W.X, args.W.Y, args.T.X, args.T.Y, args.C, args.G);
    });
    $('#cizim')[0].addEventListener('touchstart', function (e) {
        mousePressed = true;
        touchfirst = true;

    });
    $('#cizim')[0].addEventListener('touchend', function (e) {
        mousePressed = false;
    });
    $('#cizim')[0].addEventListener('touchmove', function (e) {
        var x = e.touches[0].clientX;
        var y = e.touches[0].clientY;

        if (mousePressed) {
            Draw(x, y, true);
        }
    });
    $('#cizim').mousedown(function (e) {
        mousePressed = true;
        Draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, false);
    });

    $('#cizim').mousemove(function (e) {
        if (mousePressed) {
            Draw(e.pageX - $(this).offset().left, e.pageY - $(this).offset().top, true);
        }
    });

    $('#cizim').mouseup(function (e) {
        mousePressed = false;
    });
    $('#cizim').mouseleave(function (e) {
        mousePressed = false;
    });
    function Draw(x, y, isDown) {

        if (isNaN(x) || isNaN(y))
            return;
        if (touchfirst) {
            lastX = x; lastY = y;
            touchfirst=false;
            return;
        }
        if (isDown) {
            socket.emit("ciz", {
                W: { X: lastX, Y: lastY },
                T: { X: x, Y: y },
                C: $('#renk').val(),
                G: $('#genislik').val()
            }
            );
        }
        lastX = x; lastY = y;
    }
    function DrawR(fx, fy, tx, ty, renk, genislik) {
        ctx.beginPath();
        ctx.strokeStyle = renk;
        ctx.lineWidth = genislik;
        ctx.lineJoin = "round";
        ctx.moveTo(fx, fy);
        ctx.lineTo(tx, ty);
        ctx.closePath();
        ctx.stroke();

    }


</script>
</body>

</html>